<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TECHVIDYA 2K25 - CHANAKYOTSAV BROCHURE</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap');

        html, body {
            margin: 0;
            padding: 0;
            background-color: #0a0a0a;
            font-family: 'Oswald', sans-serif;
            color: white;
            height: 100%;
            display: flex;
            flex-direction: column;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        html::-webkit-scrollbar,
        body::-webkit-scrollbar {
            display: none;
        }

        header {
            padding: 2.5rem 2rem;
            border-bottom: 1px solid #222;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            text-align: center;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 500;
            margin: 0;
        }
        
        .pdf-container {
            flex-grow: 1;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .pdf-container::-webkit-scrollbar {
            display: none;
        }

        #pdf-viewer {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem 0;
            box-sizing: border-box;
        }

        .page-wrapper {
            width: 90%;
            max-width: 800px;
            margin-bottom: 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            min-height: 400px; /* Placeholder height */
            background-color: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .page-wrapper canvas {
            width: 100%;
            height: auto;
            display: block;
        }

        .loading-placeholder {
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <header>
        <h1>TECHVIDYA 2K25 - CHANAKYOTSAV BROCHURE</h1>
    </header>

    <div class="pdf-container" id="pdf-container">
        <div id="pdf-viewer"></div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        const url = 'https://pub-01b86a07b6904467a8a45ae0ec6c8c9e.r2.dev/TechVidya-Brochure.pdf';
        const container = document.getElementById('pdf-viewer');
        const scrollContainer = document.getElementById('pdf-container');

        // Reduced scale for faster mobile rendering
        const SCALE = window.innerWidth < 768 ? 1.0 : 1.2;
        
        // Get target page from URL
        const params = new URLSearchParams(window.location.search);
        let targetPageNum = parseInt(params.get('page'), 10) || 1;

        let pdfDoc = null;
        const renderedPages = new Set();
        const pageWrappers = [];

        // IntersectionObserver for lazy loading
        const observerOptions = {
            root: scrollContainer,
            rootMargin: '200px', // Start loading 200px before entering viewport
            threshold: 0.01
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const pageNum = parseInt(entry.target.dataset.pageNum);
                    if (!renderedPages.has(pageNum)) {
                        renderPage(pageNum);
                    }
                }
            });
        }, observerOptions);

        // Render a specific page
        function renderPage(pageNum) {
            if (renderedPages.has(pageNum) || !pdfDoc) return;
            
            renderedPages.add(pageNum);
            
            pdfDoc.getPage(pageNum).then(page => {
                const viewport = page.getViewport({ scale: SCALE });
                const wrapper = pageWrappers[pageNum - 1];
                
                // Remove loading placeholder
                wrapper.innerHTML = '';
                
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                
                wrapper.appendChild(canvas);
                
                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                
                page.render(renderContext).promise.then(() => {
                    console.log('Page', pageNum, 'rendered');
                }).catch(err => {
                    console.error('Error rendering page', pageNum, err);
                });
            }).catch(err => {
                console.error('Error loading page', pageNum, err);
            });
        }

        // Load PDF
        const loadingTask = pdfjsLib.getDocument(url);
        loadingTask.promise.then(pdf => {
            pdfDoc = pdf;
            const numPages = pdf.numPages;
            
            if (targetPageNum > numPages) targetPageNum = numPages;

            // Create placeholder wrappers for all pages
            for (let i = 1; i <= numPages; i++) {
                const wrapper = document.createElement('div');
                wrapper.className = 'page-wrapper';
                wrapper.dataset.pageNum = i;
                wrapper.innerHTML = '<div class="loading-placeholder">Loading page ' + i + '...</div>';
                container.appendChild(wrapper);
                pageWrappers.push(wrapper);
                
                // Observe all pages for lazy loading
                observer.observe(wrapper);
            }

            // Render target page immediately (priority)
            renderPage(targetPageNum);
            
            // Scroll to target page after a brief delay
            setTimeout(() => {
                pageWrappers[targetPageNum - 1].scrollIntoView({ 
                    behavior: 'auto', 
                    block: 'start' 
                });
            }, 100);

        }).catch(err => {
            console.error('Error loading PDF:', err);
            container.innerHTML = '<p style="color: white; text-align: center; padding: 2rem;">Error loading PDF.</p>';
        });
    </script>
</body>
</html>
